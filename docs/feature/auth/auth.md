## what it is
- 当请求通过lb转发到后端时，可以让lb做些 校验/鉴权的逻辑。
- 基本逻辑为: 如果请求中有某些header，或者向另外一个地址发起请求并返回了200.则校验通过，继续将请求转发到后端，否则返回401
## alb auth ingress annotation 支持情况

|                                                                                                                                                                                                                 | support | type                | note                                                                                                                                                                   |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|---------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| local-auth                                                                                                                                                                                                      |         |                     | 只通过请求中的header来判断，不需要额外发请求.<br>他的一般流程是，在ingress上指定一个secret其中有用户的帐号和密码<br>header带有帐号密码，lb检查其是否与secret中配置的一致。 |
| [nginx.ingress.kubernetes.io/auth-realm](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#authentication)                                               |         | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-secret](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#authentication)                                              |         | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-secret-type](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#authentication)                                         |         | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-type](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#authentication)                                                |         | "basic" or "digest" | basic: secret中密码的格式是base64编码的帐号密码<br>digest: 暂不支持                                                                                                    |
| remote-auth                                                                                                                                                                                                     |         |                     | 通过向其他发请求，并根据请求结果来决定是否校验通过                                                                                                                      |
| [nginx.ingress.kubernetes.io/auth-url](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                                        |         | string              | 发起请求的ur                                                                                                                                                           |
| [nginx.ingress.kubernetes.io/auth-method](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                                     |         | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-signin]()                                                                                                                                                                     |         | string              | 当请求失败时，不是返回401，而是返回302 调转到指定的地址登录<br>配置oauth时会用到                                                                                         |
| [nginx.ingress.kubernetes.io/auth-signin-redirect-param]()                                                                                                                                                      |         | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-response-headers]()                                                                                                                                                           |         | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-proxy-set-headers]()                                                                                                                                                          |         | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-request-redirect]()                                                                                                                                                           |         | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-always-set-cookie]()                                                                                                                                                          |         | boolean             |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-snippet](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                                    | x       | string              | 做auth请求时，nginx的配置。                                                                                                                                              |
| auth-cache                                                                                                                                                                                                      |         |                     | 指定发起请求时，是否使用cache                                                                                                                                           |
| [nginx.ingress.kubernetes.io/auth-cache-key](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                                  | x       | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-cache-duration](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                             | x       | string              |                                                                                                                                                                        |
| auth-keepalive                                                                                                                                                                                                  |         |                     | 发请求时，使用keepalive长连接。通过一系列annotation指定keepalive的行为                                                                                                   |
| [nginx.ingress.kubernetes.io/auth-keepalive](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                                  | x       | number              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-keepalive-share-vars](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                       | x       | "true" or "false"   |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-keepalive-requests](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                         | x       | number              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-keepalive-timeout](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#external-authentication)                          | x       | number              |                                                                                                                                                                        |
| auth-tls                                                                                                                                                                                                        |         |                     | 当请求是https时，额外校验请求发过来的证书.                                                                                                                              |
| [nginx.ingress.kubernetes.io/auth-tls-secret](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#client-certificate-authentication)                       | x       | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-tls-verify-depth](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#client-certificate-authentication)                 | x       | number              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-tls-verify-client](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#client-certificate-authentication)                | x       | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-tls-error-page](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#client-certificate-authentication)                   | x       | string              |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#client-certificate-authentication) | x       | "true" or "false"   |                                                                                                                                                                        |
| [nginx.ingress.kubernetes.io/auth-tls-match-cn](https://github.com/kubernetes/ingress-nginx/blob/main/docs/user-guide/nginx-configuration/annotations.md#client-certificate-authentication)                     | x       | string              |                                                                                                                                                                        |
## ingress-nginx 其他特性
### global-auth
在ingress-nginx中可以通过configmap设置一个全局的auth。相当给所有的ingress配置了auth
## no-auth-locations [¶](https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/configmap/#no-auth-locations "Permanent link")
支持通过ingress annotation指定某个path 不用做auth
## alb
### alb special ingress annotation

## 与ingress-nginx 不兼容的部分
1. 不支持 auth-snippet
2. 不支持 cache
3. 不支持 auth-tls
4. basic-auth 只支持basic 不支持digest
5. basic-auth basic 只支持apr1算法，不支持bcrypt sha256等
